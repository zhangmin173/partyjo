if("undefined"==typeof jQuery)throw new Error("丢失jQuery库文件");window.debug=!1,window._global={browser:null,url:{api:"//wechat.nextdog.cc/partyjo-web/api/"},root:"https://yc.huzhou.gov.cn:8088/wsdt/rest",key:"WXUSERINFO"},function(e){var n=["openAddress","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","startRecord","stopRecord","onVoiceRecordEnd","playVoice","pauseVoice","stopVoice","onVoicePlayEnd","uploadVoice","downloadVoice","chooseImage","previewImage","uploadImage","downloadImage","translateVoice","getNetworkType","openLocation","getLocation","hideOptionMenu","showOptionMenu","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","closeWindow","scanQRCode","chooseWXPay","openProductSpecificView","addCard","chooseCard","openCard"];_global&&_global.jsapi_config&&(wx.config({debug:debug,appId:_global.jsapi_config.appId,timestamp:_global.jsapi_config.timestamp,nonceStr:_global.jsapi_config.nonceStr,signature:_global.jsapi_config.signature,jsApiList:n}),wx.ready(function(){})),e.extend({init:function(){this.templateConfig(),_global.browser={agent:e.browser.agent(),system:e.browser.system()},this.log(_global,"全局参数"),this.h5show()},templateConfig:function(){template.config("escape",!1),template.config("openTag","{"),template.config("closeTag","}")},h5show:function(){e(function(){e("body").append('<a class="home-menu" href="index.html"><img src="./img/icon/home.png"></a>')})},browser:{u:window.navigator.userAgent,type:function(){if(u=this.u.toLowerCase(),u.indexOf("khtml")>-1||u.indexOf("konqueror")>-1||u.indexOf("applewebKit")>-1)var e=u.indexOf("chrome")>-1,n=u.indexOf("applewebKit")>-1&&!e;return window.opr&&u.indexOf("opr")>-1?"Opera":e?"Chrome":n?"Safari":u.indexOf("firefox")>0?"Firefox":"unknow"},agent:function(){u=this.u.toLowerCase();var e=window.external;return/msie/.test(u)?"IE":u.indexOf("firefox")>0?"Firefox":u.indexOf("micromessenger")>-1?"weixin":u.indexOf("opr")>0?"Opera":u.indexOf("qqbrowser")>-1?"qq":u.indexOf("se 2.x")>-1?"sogou":u.indexOf("maxthon")>-1?"maxthon":u.indexOf("baiduboxapp")>-1?"baidu":u.indexOf("ucbrowser")>-1?"uc":window.chrome&&e&&"LiebaoGetVersion"in e?"liebao":"unknow"},system:function(){return u=this.u,u.indexOf("Android")>-1||u.indexOf("Linux")>-1?"Android":u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?"ios":"unknow"}},getUrlPara:function(e){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),o=window.location.search.substr(1).match(n);return null!=o?unescape(o[2]):null},wxShare:function(n){n=e.extend({title:"",desc:"",link:"",imgUrl:"",type:"link",dataUrl:"",trigger:function(){},complete:function(){},success:function(){},fail:function(){}},n),wx.ready(function(){var o={title:n.title,link:n.link,imgUrl:n.imgUrl,trigger:n.trigger,complete:n.complete,success:n.success,fail:n.fail};wx.onMenuShareAppMessage(e.extend(o,{desc:n.desc,type:n.type,dataUrl:n.dataUrl})),wx.onMenuShareTimeline(o),wx.onMenuShareQQ(e.extend(o,{desc:n.desc})),wx.onMenuShareWeibo(e.extend(o,{desc:n.desc}))})},isRegister:function(n,o){window.debug?e.fetch({url:"/hzzwfwWxUser/wzUserDetailByOpenID",data:{openid:"o9-y-0zpSkPbcDqRpUel0kK50Adc"},success:function(e){n(e)},fail:function(n){e.pop(n.custom.text);var t=location.href;o?o(n):location.href="/partyjo/online-administration/login.html?openid="+n.data.openid+"&targetUrl="+t}}):e.request("is_oauth",{url:window.location.href},function(t){console.log(t);var i=t.data.openid;e.fetch({url:"/hzzwfwWxUser/wzUserDetailByOpenID",data:{openid:i},success:function(e){e.wx=t.data,n(e)},fail:function(n){e.pop(n.custom.text);var t=location.href;o?o(n):location.href="/partyjo/online-administration/login.html?openid="+i+"&targetUrl="+encodeURIComponent(t)}})})},wxUserBind:function(n,o,t){e.fetch({url:"/hzzwfwWxUser/wxUserBind",data:n,success:function(e){o(e)},fail:function(e){t&&t(e)}})},wxNewUserBind:function(n,o,t){e.fetch({url:"/hzzwfwWxUser/wxNewUserBind",data:n,success:function(e){o(e)},fail:function(e){t&&t(e)}})},register:function(n,o,t){e.fetch({url:"/hzzwfwWxUser/wxUserRegister",data:n,success:function(e){o(e)},fail:function(e){t&&t(e)}})},encodeUtf8:function(e){var n=escape(e).split("%"),o="";""!==n[0]&&(o=n[0]);for(var t=1;t<n.length;t++)"u"==n[t].substring(0,1)?(o+=Hex2Utf8(Str2Hex(n[t].substring(1,5))),n[t].length>5&&(o+=n[t].substring(5))):o+="%"+n[t];return o},encode:function(n){var o="",t="",i=0,a=(n=(n=e.encodeUtf8(n)).replace(/%/g,"_PERCENT_")).length;do{t=n.charCodeAt(i++),o=o+"="+(t-=i)}while(i<a);return o},request:function(n,o,t,i,a){var r=JSON.parse(window.localStorage.getItem(window._global.key));if("is_oauth"===n&&r)return window._global.user=r,console.log(r),t&&t({data:r}),!1;var s="post";i&&(s=i),e.loading(),paras=e.extend({},o),a&&(paras.token=a.token),e.log(paras,n+"请求参数"),e.ajax({type:s,url:_global.url.api+n,dataType:"json",data:paras}).done(function(o){e.loading(),e.log(o,n+"返回数据"),999==o.ret?e.request("is_oauth",{url:window.location.href}):1001==o.ret?window.location.href=o.data:1002==o.ret?(window.location.href.indexOf("register")>=0||confirm("现在去注册？")&&(window.location.href="login.html"),window.localStorage.setItem(window._global.key,JSON.stringify(o.data)),window._global.user=o.data):("is_oauth"===n&&(window.localStorage.setItem(window._global.key,JSON.stringify(o.data)),window._global.user=o.data),t&&t(o))}).fail(function(){e.pop("请求失败"),setTimeout(function(){e.loading()},800),e.log("请求失败",n+"接口错误")})},fetch:function(n){var o={url:"",data:{},success:null,fail:null,type:"post",user:{token:""},error:null},t=e.extend(o,n);e.loading(),paras=e.extend({centerguid:"6bef18db-f0b8-49fd-9d39-e406ad6d5bd5"},t.data);var i={token:"Epoint_WebSerivce_**##0601",params:paras};e.log(i,t.url+"请求参数"),e.ajax({type:t.type,url:_global.root+t.url,dataType:"json",data:JSON.stringify(i),headers:{Accept:"text/html;charset=utf-8",Authorization:"Bearer "+t.user.token||""},contentType:"application/json;charset=UTF-8"}).done(function(n){e.loading(),e.log(n,t.url+"返回数据"),200==n.status.code&&1==n.custom.code?t.success&&t.success(n):t.fail?t.fail(n):e.pop(n.custom.text)}).fail(function(){e.pop("请求失败"),setTimeout(function(){e.loading()},800),e.log("请求失败",t.url+"接口错误")})},resize:function(n){n(),e(window).on("resize",function(){n()})},render:function(e,n,o){o(template(e,n))},log:function(e,n){debug&&(n&&console.log("------- "+n+" -------"),console.log(e),n&&console.log("------- "+n+" -------"))},form2Json:function(n){var o=e(n).serializeArray(),t={};return e.each(o,function(){t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""}),e.log(t,n+" 表单数据"),t},getSelectVal:function(n){return e(n+" option:selected").val()},getCheckVal:function(n){var o=[];return e('input[name="'+n+'"]:checked').each(function(){o.push(e(this).val())}),o},regCheck:{def:function(e,n){return e.test(n)},userName:function(e){return/^[_A-Za-z0-9]{6,16}$/.test(e)},psw:function(e){return/^[\w~!@#$%^&*()_+{}:"<>?\-=[\];\',.\/A-Za-z0-9]{6,16}$/.test(e)},email:function(e){return/^([a-zA-Z0-9]|[._])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/.test(e)},telNum:function(e){return/^((0\d{2,3}-\d{7,8})|(1[3|5|4|7|8][0-9]\d{8}))$/.test(e)},mobile:function(e){return/^(1[3|4|5|7|8][0-9]\d{8})$/.test(e)},verify:function(e){return/^\d{6}$/.test(e)},CN:function(e){return/^[\u4E00-\u9FA5]+$/.test(e)},carsh:function(e){return/^\d*\.?\d+$/.test(e)},num:function(e){return/^\+?[1-9][0-9]*$/.test(e)}},format:{mobile:function(e){return e.substring(0,3)+"****"+e.substring(7)}},pop:function(n){var o='<div class="m-pop">'+n+"</div>";e("body").append(o),setTimeout(function(){e(".m-pop").remove()},2e3)},loading:function(){e(".m-loading").size()?e(".m-loading").remove():e("body").append('<div class="m-loading"><span></span><span></span><span></span></div>')},loadingEnd:function(){e(".m-loading").size()&&e(".m-loading").remove()},toTop:function(n){var o=e.extend({},{publish:!1,bottom:"1.36rem",str:'<div class="sidebar"><a id="j-note-add" class="sidebar-item note-add" href="/note/add"></a><a id="j-refresh" class="sidebar-item refresh active" href="javascript:window.location.reload();"></a><div id="j-top" class="sidebar-item go-top"></div></div>'},n);e("body").append(o.str),_global.site_info.config.is_open_publish&&o.publish&&e("#j-note-add").addClass("active");var t=e("#j-top");t.css("bottom",o.bottom),t.hide(),e(window).on("scroll",function(){e(window).scrollTop()>=800?t.fadeIn():t.stop(!0).fadeOut()}),t.css({bottom:o.bottom}),t.on("click",function(){return e("html, body").animate({scrollTop:0},500),!1})}}),e.fn.extend({}),e.init()}(jQuery);